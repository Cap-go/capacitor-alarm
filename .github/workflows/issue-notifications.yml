name: Notify Discord on Issue and PR

on:
  schedule:
    - cron: "0 * * * *" # Runs every hour
  workflow_dispatch: # Optional

jobs:
  run-notifier:
    runs-on: ubuntu-latest
    strategy:
      matrix:
        task: [monitor-issues, monitor-prs]
    steps:
      - name: Extract repository info
        id: repo-info
        env:
          GITHUB_REPOSITORY: ${{ github.repository }}
        run: |
          repo="${GITHUB_REPOSITORY}"
          owner="${repo%%/*}"
          name="${repo#*/}"
          echo "repo_owner=$owner" >> "$GITHUB_OUTPUT"
          echo "repo_name=$name" >> "$GITHUB_OUTPUT"
      - name: Set up Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '22'
      - name: Monitor ${{ matrix.task }}
        uses: shubhaamgupta11/repo-monitor@v1.0.4
        with:
          # required inputs
          task: "${{ matrix.task }}"
          git_secret: "${{ secrets.PERSONAL_ACCESS_TOKEN }}"
          notifier: "discord"
          fetch_data_interval: 1  # Hours (must align with your cron schedule)
          # repo inputs
          repo_owner: "${{ steps.repo-info.outputs.repo_owner }}"
          repo_name: "${{ steps.repo-info.outputs.repo_name }}"
          # Discord-specific inputs
          discord_webhook_url: "${{ secrets.DISCORD_ISSUE_WEBHOOK_URL }}"
